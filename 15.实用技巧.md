# 实用技巧

### 1. 实现权限规则: 

   + 每个权限数为2的n次方, 不重复:

     ```c#
     Role_A = 2,
     
     Role_B = 4,
     
     Role_C = 8
     ```

   + 使用【按位与运算符 &】添加权限: 

     ```c#
     userRole = userRole | Role_A     //在userRole权限的基础上新增Role_A权限
     ```

   + 使用【按位或运算符 |】判断此用户是否拥有指定的权限:

     ```c#
     if(userRole & Role_A == Role_A)	//userRole是否拥有Role_A权限
     {
         return "userRole has Role_A authority"
     }
     ```
     
   + 使用【按位异或运算符 ^】移除指定的权限:

     ```c#
      userRole = userRole ^ Role_A  //移除userRole的Role_A权限
     ```
   
     

   参考:

   + 逻辑运算符 【& | ^ 】:

     https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/operators/boolean-logical-operators#logical-exclusive-or-operator-
   
   + 位运算符和移位运算符:
   
     https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/operators/bitwise-and-shift-operators
   
   + example:
   
     https://github.com/halfcrazy/blog/issues/1

### 2. 使用泛型:

   + 约束泛型:
   
     + 指定泛型类型都继承某个基类 where T : 基类
     + 泛型类型T可实例化: new() 同时T对应的实际类型必须含有无参数的构造函数
   
   + EFCore Context使用泛型: DbContext.Set<TEntity>() 即例如: _context.Set<实际类型>().Where().ToList();
   
     https://docs.microsoft.com/zh-cn/dotnet/api/system.data.entity.dbcontext.set?view=entity-framework-6.2.0

### 3. 使用解构元组:

   + [元组类型 - C# 参考 | Microsoft Docs](https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/value-tuples)

     ```c#
     var (a, b) = Method();
     Console.WriteLine($"{a} and {b}");
     private (DateTime,DateTime) Method()
     {
         // TODO 
         return (DateTime.Now, DateTime.Now);
     }
     ```

### 4. 解决生成的url A有时限的问题:

   + 使用url B跳转到DownloadReport的action, 在这个action中生成url A; 即每次点击url B都会重新生成一个url A, 解决了url有时限的问题
   + **问题**：生成的url A如果带非ascii编码的字符（中文）则跳转会发生异常，可以选择转码或者【5】

```c#
// 调用urlB: url/downloadReport

//处理跳转url B之后的逻辑
[HttpGet("downloadReport")]
public async Task<IActionResult> DownloadReport()
{
    //todo 生成一个url A
    return Redirect(urlA);//跳转到实际的url A
}

```
### 5. 使用Content()方法：

```c#
//重定向到指定的Content页面并把浏览器重定向到downloadUri
return Content("<html><head><meta charset='utf-8'></head><script>window.location.href ='" + downloadUri + "'</script></html>","text/html");
```

### 6. 安装package:

> Install-Package PacakgeName -ProjectName ProjectName



### 7. **数据类型为A的data转换为类型为T的result**:

> 使用T.TryParse():

```c#
var result = T.TryParse(data,out A data) ? data:default(T);
```

